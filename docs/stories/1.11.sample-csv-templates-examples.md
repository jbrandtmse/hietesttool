# Story 1.11: Sample CSV Templates & Examples

## Status
Done

## Story

**As a** new user,
**I want** sample CSV files and documentation,
**so that** I can quickly understand the expected format and start creating test data.

## Acceptance Criteria

1. Sample CSV file created in `examples/patients_sample.csv` with 10 diverse patient records
2. Sample includes all required columns and demonstrates optional columns
3. Sample demonstrates mix of provided patient IDs and empty IDs (for auto-generation testing)
4. Sample includes varied demographics: multiple genders, age ranges, complete and partial addresses
5. CSV column documentation created in `docs/csv-format.md` explaining each field, data types, and validation rules
6. Documentation includes common OID values for testing (e.g., example OIDs for different healthcare organizations)
7. Troubleshooting section in documentation addresses common CSV formatting issues
8. Quick start guide includes step-by-step example using sample CSV file
9. Sample demonstrates UTF-8 encoding and proper handling of special characters in names
10. Additional minimal example CSV (`examples/patients_minimal.csv`) with only required columns for simplest use case

## Tasks / Subtasks

- [x] Create comprehensive sample CSV file (AC: 1, 2, 3, 4, 9)
  - [x] Create `examples/patients_sample.csv` with 10 diverse patient records
  - [x] Include all required columns: `first_name`, `last_name`, `dob`, `gender`, `patient_id_oid`
  - [x] Include all optional columns: `patient_id`, `mrn`, `ssn`, `address`, `city`, `state`, `zip`, `phone`, `email`
  - [x] Mix provided patient IDs (5 records) and empty IDs (5 records) to demonstrate auto-generation
  - [x] Include diverse demographics: all genders (M, F, O, U), various age ranges (child, adult, senior)
  - [x] Demonstrate complete addresses (5 records) and partial addresses (5 records)
  - [x] Use UTF-8 encoding with special characters in names (accents, apostrophes, hyphens)
  - [x] Ensure proper CSV formatting (quoted fields with commas, proper escaping)
  - [x] Use realistic but fake demographic data (names, addresses, phone numbers)

- [x] Create minimal sample CSV file (AC: 10)
  - [x] Create `examples/patients_minimal.csv` with 3 patient records
  - [x] Include only required columns: `first_name`, `last_name`, `dob`, `gender`, `patient_id_oid`
  - [x] All records should have empty `patient_id` to demonstrate auto-generation
  - [x] Keep data simple for easiest possible example

- [x] Create comprehensive CSV format documentation (AC: 5, 6, 7)
  - [x] Create `docs/csv-format.md` with complete CSV specification
  - [x] Document each column with: name, type, required/optional, validation rules, examples
  - [x] **Required columns section:**
    - `first_name` (string, required, 1-100 chars, Unicode supported)
    - `last_name` (string, required, 1-100 chars, Unicode supported)
    - `dob` (date, required, format YYYY-MM-DD, validation: past date only)
    - `gender` (string, required, values: M/F/O/U, case-insensitive)
    - `patient_id_oid` (string, required, OID format: numeric dotted notation like 2.16.840.1.113883.3.xxx)
  - [x] **Optional columns section:**
    - `patient_id` (string, optional, if empty triggers auto-generation with format TEST-{UUID})
    - `mrn` (string, optional, medical record number)
    - `ssn` (string, optional, format XXX-XX-XXXX, validation: basic format check)
    - `address` (string, optional, street address)
    - `city` (string, optional)
    - `state` (string, optional, 2-letter state code)
    - `zip` (string, optional, format XXXXX or XXXXX-XXXX)
    - `phone` (string, optional, format flexible but validated)
    - `email` (string, optional, basic email format validation)
  - [x] Document common OID values for testing (AC: 6)
    - Example OID for testing: `2.16.840.1.113883.3.9999.1` (generic test organization)
    - Common healthcare OIDs: Medicare, Medicaid, etc.
    - Link to OID registry resources
  - [x] Create troubleshooting section (AC: 7)
    - Common CSV errors: missing required columns, invalid date formats, invalid gender values
    - CSV encoding issues (BOM markers, non-UTF-8 encoding)
    - Special character handling (quotes, commas, line breaks in fields)
    - Date format issues (US vs international formats)
    - Patient ID generation not triggering (whitespace in empty cells)
  - [x] Add CSV creation tips section
    - Recommended tools: Excel, LibreOffice, Google Sheets
    - How to save as UTF-8 CSV
    - How to avoid common spreadsheet export issues

- [x] Update README.md with quick start example (AC: 8)
  - [x] Add "Quick Start" section to README.md
  - [x] Include step-by-step tutorial using `examples/patients_sample.csv`
  - [x] Step 1: Copy sample CSV to local directory
  - [x] Step 2: Validate CSV with `ihe-test-util csv validate examples/patients_sample.csv`
  - [x] Step 3: Process CSV with `ihe-test-util csv process examples/patients_sample.csv`
  - [x] Step 4: Review output showing parsed patients and auto-generated IDs
  - [x] Reference detailed CSV format documentation (`docs/csv-format.md`)
  - [x] Link to sample files in examples/ directory

- [x] Create examples/README.md (documentation)
  - [x] Document purpose of examples directory
  - [x] Describe each example file: `patients_sample.csv`, `patients_minimal.csv`, `config.example.json`
  - [x] Provide usage instructions for each example
  - [x] Link to detailed documentation for each example type

- [x] Validate sample files against existing CSV parser (AC: 1, 2, 10)
  - [x] Run `ihe-test-util csv validate examples/patients_sample.csv` to ensure it passes
  - [x] Run `ihe-test-util csv process examples/patients_sample.csv` to verify parsing works
  - [x] Verify auto-generated IDs are created for empty patient_id fields
  - [x] Verify validation catches errors when required fields are removed
  - [x] Run same validation for `examples/patients_minimal.csv`
  - [x] Verify UTF-8 special characters parse correctly

- [x] Create unit tests (optional - validation testing)
  - [x] Skipped (optional task) - manual validation testing sufficient

## Dev Notes

### Previous Story Insights

[Source: Story 1.5 Completion Notes]

Story 1.5 implemented the CSV parser with validation. Story 1.11 provides sample CSV files and documentation for users to understand the format.

**What Story 1.5 Implemented:**
- CSV parser in `src/ihe_test_util/csv_parser/parser.py`
- Required columns: `first_name`, `last_name`, `dob`, `gender`, `patient_id_oid`
- Optional columns: `patient_id`, `mrn`, `ssn`, `address`, `city`, `state`, `zip`, `phone`, `email`
- Date validation (YYYY-MM-DD format, past dates only)
- Gender validation (M, F, O, U, case-insensitive)
- UTF-8 encoding support

[Source: Story 1.6 Completion Notes]

Story 1.6 implemented patient ID auto-generation:
- Format: `TEST-{UUID}` for auto-generated IDs
- Triggered when `patient_id` column is empty
- Seed parameter for reproducible generation

**What Story 1.11 Will Add:**
- Sample CSV files demonstrating parser capabilities
- Comprehensive CSV format documentation
- Quick start guide and troubleshooting
- Examples directory README

### Tech Stack & Dependencies

[Source: architecture/tech-stack.md]

**Documentation:**
- Markdown for all documentation files
- No special tools or dependencies required

**CSV Files:**
- UTF-8 encoding (standard)
- Standard CSV format (RFC 4180)
- No libraries needed for sample file creation

**Validation:**
- Use existing CSV parser from Story 1.5 to validate sample files
- CLI commands: `csv validate`, `csv process`

### File Locations

[Source: architecture/source-tree.md]

**Sample CSV Files:**
- `examples/patients_sample.csv` - NEW: Comprehensive sample with 10 diverse patients
- `examples/patients_minimal.csv` - NEW: Minimal sample with only required columns
- `examples/README.md` - NEW: Examples directory documentation

**Documentation Files:**
- `docs/csv-format.md` - NEW: Complete CSV format specification
- `README.md` - MODIFY: Add Quick Start section

**Test Files:**
- `tests/unit/test_sample_csv_files.py` - NEW (optional): Validate sample files

### Coding Standards

[Source: architecture/coding-standards.md]

**File Encoding:**
- RULE: All CSV files MUST use UTF-8 encoding without BOM
- RULE: Markdown files MUST use UTF-8 encoding
- RULE: Line endings should be LF (Unix-style) not CRLF

**Documentation Standards:**
- Use Markdown format for all documentation
- Include code examples with proper syntax highlighting
- Use tables for structured information
- Include troubleshooting sections with common issues

**CSV File Standards:**
- Follow RFC 4180 CSV format
- Use header row with column names
- Quote fields containing commas, quotes, or newlines
- Use UTF-8 encoding for special characters
- No BOM (Byte Order Mark)

### CSV Format Specification

[Source: Story 1.5 ACs and Epic 1 Story 1.5]

**Required Columns:**
1. `first_name` (string, 1-100 characters, Unicode supported)
2. `last_name` (string, 1-100 characters, Unicode supported)
3. `dob` (date, format YYYY-MM-DD, must be past date)
4. `gender` (string, values: M/F/O/U, case-insensitive)
5. `patient_id_oid` (string, OID format: numeric dotted notation)

**Optional Columns:**
1. `patient_id` (string, if empty → auto-generated as TEST-{UUID})
2. `mrn` (string, medical record number)
3. `ssn` (string, format XXX-XX-XXXX)
4. `address` (string, street address)
5. `city` (string)
6. `state` (string, 2-letter code)
7. `zip` (string, XXXXX or XXXXX-XXXX)
8. `phone` (string, flexible format)
9. `email` (string, basic email validation)

**Validation Rules:**
- Date of birth: Must be in past (not future), format YYYY-MM-DD
- Gender: Must be M, F, O, or U (case-insensitive)
- OID: Must be numeric dotted notation (e.g., 2.16.840.1.113883.3.9999.1)
- Patient ID: If empty, triggers auto-generation with TEST-{UUID} format

### Sample Data Requirements

[Source: AC 1, 3, 4, 9]

**Comprehensive Sample (patients_sample.csv):**
- 10 patient records total
- Gender distribution: M (3), F (4), O (2), U (1)
- Age ranges: Child (<18): 2, Adult (18-64): 5, Senior (65+): 3
- Patient IDs: 5 provided, 5 empty (for auto-generation demo)
- Addresses: 5 complete, 5 partial (missing optional fields)
- UTF-8 special characters: Include names with accents (José, François), apostrophes (O'Brien), hyphens (Mary-Jane)

**Minimal Sample (patients_minimal.csv):**
- 3 patient records
- Only required columns
- All patient IDs empty (demonstrate auto-generation)
- Simple demographic data

**Example OIDs for Testing:**
- Generic test OID: `2.16.840.1.113883.3.9999.1`
- Test hospital A: `2.16.840.1.113883.3.9999.10`
- Test clinic B: `2.16.840.1.113883.3.9999.20`

### Documentation Structure

[Source: AC 5, 6, 7, 8]

**docs/csv-format.md Structure:**
1. Introduction - Purpose and overview
2. CSV Format Basics - Standard CSV format rules
3. Required Columns - Detailed specifications
4. Optional Columns - Detailed specifications
5. Validation Rules - What parser checks
6. Common OID Values - Test OIDs and resources
7. Examples - Minimal and comprehensive examples
8. Troubleshooting - Common issues and solutions
9. CSV Creation Tips - Tools and best practices

**README.md Quick Start:**
1. Installation instructions (if not already present)
2. Quick Start section
3. Step-by-step example with sample CSV
4. Expected output examples
5. Link to detailed documentation

### Project Structure Notes

All file paths verified against architecture/source-tree.md:
- Sample CSVs: `examples/` directory (existing)
- Documentation: `docs/` directory (existing)
- Tests: `tests/unit/` (existing structure)
- README.md: project root (existing)

No structural conflicts identified.

### Testing

**Test Framework:** pytest 7.4+

**Test Files:**
- `tests/unit/test_sample_csv_files.py` - NEW (optional): Validate sample files work correctly

**Test Pattern:** AAA (Arrange, Act, Assert)

**Key Test Scenarios:**
- Sample CSV files load successfully
- Sample CSV files pass validation
- Auto-generated IDs work with empty patient_id fields
- UTF-8 special characters parse correctly
- Both comprehensive and minimal samples are valid

**Note:** Testing for this story is optional since it's primarily documentation and sample files. The main validation is running the existing CSV parser against the sample files to ensure they work correctly.

## Dev Agent Record

### Agent Model Used
Claude 3.5 Sonnet (claude-3-5-sonnet-20241022)

### Completion Notes

**Story 1.11 completed successfully.**

All acceptance criteria met:
- ✅ AC 1-4, 9: Created `examples/patients_sample.csv` with 10 diverse patient records
  - All required and optional columns included
  - Mix of 5 provided patient IDs and 5 empty IDs (for auto-generation demo)
  - Diverse demographics: M (3), F (4), O (2), U (1); Child (2), Adult (5), Senior (3)
  - UTF-8 special characters: José, François, Mary-Jane, Amélie, Müller, Bjørnsson
  - Complete addresses (5) and partial addresses (5)
- ✅ AC 5, 6, 7: Created comprehensive `docs/csv-format.md` documentation
  - Complete CSV specification with all columns documented
  - Common OID values for testing provided
  - Troubleshooting section with common issues and solutions
  - CSV creation tips for Excel, Google Sheets, LibreOffice
- ✅ AC 8: Updated `README.md` with Quick Start tutorial
  - Step-by-step example using sample CSV file
  - Clear instructions for validate and process commands
  - Expected output examples provided
- ✅ AC 10: Created `examples/patients_minimal.csv` with 3 records
  - Only required columns included
  - Simple data for easiest possible example

**Additional work completed:**
- Created `examples/README.md` documenting all example files
- Validated both sample files against existing CSV parser
  - `patients_sample.csv`: Validation passed (10 valid rows, 17 warnings as expected)
  - `patients_minimal.csv`: Validation passed perfectly (3 valid rows, 0 warnings)
- Verified CSV processing command works correctly
- Both sample files demonstrate auto-generated patient IDs in TEST-{UUID} format

**Testing performed:**
- Manual validation: `python -m ihe_test_util csv validate examples/patients_sample.csv` ✓
- Manual validation: `python -m ihe_test_util csv validate examples/patients_minimal.csv` ✓
- CSV processing: `python -m ihe_test_util csv process examples/patients_sample.csv` ✓
- Verified UTF-8 special characters parse correctly
- Verified auto-generated IDs created for empty patient_id fields
- Verified warnings correctly identify phone/zip format variations

**Unit tests:** Skipped (optional task) - manual validation testing sufficient for sample files.

### Debug Log References
None - No issues encountered during implementation.

### File List
**Created:**
- `examples/patients_sample.csv` (NEW) - Comprehensive sample with 10 diverse patients
- `examples/patients_minimal.csv` (NEW) - Minimal sample with only required columns
- `docs/csv-format.md` (NEW) - Complete CSV format specification and guide
- `examples/README.md` (NEW) - Examples directory documentation

**Modified:**
- `README.md` (UPDATED) - Added "Your First CSV Processing Tutorial" section to Quick Start

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-11-06 | 1.0 | Initial story creation | Scrum Master (Bob) |

## QA Results

### Review Date: 2025-11-06

### Reviewed By: Quinn (Test Architect)

### Code Quality Assessment

**Overall Assessment:** Excellent documentation and sample file quality. This story delivers comprehensive user-facing documentation and well-structured sample CSV files that effectively demonstrate all CSV parser features from Story 1.5 and ID generation from Story 1.6.

**Strengths:**
- **Comprehensive Documentation:** The `csv-format.md` is exceptionally thorough with clear examples, validation rules, troubleshooting guidance, and tool-specific instructions
- **Excellent Sample Files:** Both `patients_sample.csv` and `patients_minimal.csv` effectively demonstrate required and optional features
- **UTF-8 Special Characters:** Proper handling demonstrated with José, François, Mary-Jane, Amélie, Müller, Bjørnsson
- **User Experience Focus:** Quick Start tutorial in README.md provides clear step-by-step guidance
- **Validation Performed:** Developer manually validated both sample files against existing CSV parser

**Documentation Quality:**
- Clear organization with logical flow
- Comprehensive troubleshooting section addresses common user pain points
- Tool-specific guidance for Excel, Google Sheets, LibreOffice
- Good use of tables, code examples, and visual indicators (✅/❌)
- Excellent cross-referencing between documents

### Refactoring Performed

None required - this story contains documentation and sample data files only, no code.

### Compliance Check

- ✅ **Coding Standards:** All standards followed for documentation files
  - UTF-8 encoding used (patients_sample.csv verified as UTF-8)
  - Markdown format for all documentation
  - CSV files follow RFC 4180 standard
  - No BOM markers detected
- ✅ **Project Structure:** Files placed in correct locations per architecture/source-tree.md
  - Sample CSVs in `examples/` directory
  - Documentation in `docs/` directory
  - README.md updated appropriately
- ✅ **Testing Strategy:** Appropriate testing approach for documentation story
  - Manual validation testing performed against existing CSV parser
  - No automated tests needed for sample data files (validated by existing parser tests)
- ✅ **All ACs Met:** All 10 acceptance criteria fully satisfied with evidence

### Improvements Checklist

All items complete - no outstanding work required:

- [x] Comprehensive sample CSV created with 10 diverse patients (examples/patients_sample.csv)
- [x] Minimal sample CSV created with 3 patients (examples/patients_minimal.csv)
- [x] CSV format documentation created (docs/csv-format.md)
- [x] Examples directory documentation created (examples/README.md)
- [x] README.md Quick Start tutorial added
- [x] Manual validation testing performed for both sample files
- [x] UTF-8 special characters verified
- [x] Auto-generated patient IDs verified

**Future Enhancements (Optional - Not Blocking):**
- [ ] Consider adding integration test to validate sample files programmatically (prevents regression)
- [ ] Consider re-saving patients_minimal.csv explicitly as UTF-8 for consistency (currently ASCII, which is valid but could be more explicit)

### Requirements Traceability

All 10 acceptance criteria mapped to deliverables with validation:

| AC | Requirement | Status | Evidence |
|----|-------------|--------|----------|
| 1 | Sample CSV with 10 diverse patients | ✅ PASS | `examples/patients_sample.csv` exists with 10 records |
| 2 | Includes all required and optional columns | ✅ PASS | All 14 columns present (5 required + 9 optional) |
| 3 | Mix of provided/empty patient IDs | ✅ PASS | 5 with IDs (PAT001-PAT005), 5 empty for auto-generation |
| 4 | Varied demographics | ✅ PASS | M(3), F(4), O(2), U(1); Child(2), Adult(5), Senior(3); complete/partial addresses |
| 5 | CSV column documentation | ✅ PASS | `docs/csv-format.md` comprehensive specification (15+ sections) |
| 6 | Common OID values documented | ✅ PASS | Test OIDs section with 3 test OIDs + real-world examples |
| 7 | Troubleshooting section | ✅ PASS | Extensive troubleshooting: CSV errors, encoding, special characters |
| 8 | Quick start guide with example | ✅ PASS | "Your First CSV Processing Tutorial" in README.md |
| 9 | UTF-8 special characters demo | ✅ PASS | José, François, Mary-Jane, Amélie, Müller, Bjørnsson verified |
| 10 | Minimal example CSV | ✅ PASS | `examples/patients_minimal.csv` with 3 records, required columns only |

### Security Review

✅ **No security concerns identified.**

- Sample data uses obviously fake/test data (names like "John Doe", SSNs like "111-11-1111")
- No real PII included in any sample files
- Documentation explicitly emphasizes using test data
- Best practices section warns against storing sensitive data in configuration files

### Performance Considerations

✅ **N/A for documentation and sample data files.**

- Sample files are appropriately sized for examples (10 and 3 records)
- Documentation is well-organized for quick reference
- No performance concerns

### Non-Functional Requirements Assessment

**Maintainability:**
- ✅ **PASS** - Excellent documentation structure makes maintenance easy
- Clear organization, comprehensive examples, troubleshooting guidance
- Well-linked documentation ecosystem (cross-references between docs)

**Usability:**
- ✅ **PASS** - Outstanding user experience
- Step-by-step Quick Start tutorial with expected output
- Multiple examples (comprehensive and minimal) for different user needs
- Tool-specific guidance for common spreadsheet applications
- Troubleshooting section addresses common pain points

**Reliability:**
- ✅ **PASS** - Sample files validated against existing parser
- Manual validation testing performed and documented
- UTF-8 encoding verified for patients_sample.csv
- Both samples process correctly with auto-generated IDs

### Files Modified During Review

None - review only, no modifications needed.

### Gate Status

**Gate:** PASS → docs/qa/gates/1.11-sample-csv-templates-examples.yml

**Decision Rationale:** All 10 acceptance criteria fully met with comprehensive evidence. Excellent documentation quality with thorough examples, troubleshooting guidance, and user-focused content. Proper validation testing performed. No blocking issues identified.

**Quality Score:** 100/100
- No critical issues (0 × 20 = 0)
- No concerns (0 × 10 = 0)
- Final score: 100 - 0 - 0 = 100

### Recommended Status

✅ **Ready for Done**

All acceptance criteria met, comprehensive documentation delivered, validation testing performed, no outstanding issues. Story is complete and ready to merge.

**Outstanding Work:** None

**Next Steps:** Mark story as Done and merge to main branch.
